{"version":3,"file":"watch-cli.js","sources":["../../node_modules/time-zone/index.js","../../node_modules/date-time/index.js","../../node_modules/signal-exit/signals.js","../../node_modules/signal-exit/index.js","../../cli/run/resetScreen.ts","../../cli/run/watch-cli.ts"],"sourcesContent":["export default function timeZone(date = new Date()) {\n\tconst offset = date.getTimezoneOffset();\n\tconst absOffset = Math.abs(offset);\n\tconst hours = Math.floor(absOffset / 60);\n\tconst minutes = absOffset % 60;\n\tconst minutesOut = minutes > 0 ? ':' + ('0' + minutes).slice(-2) : '';\n\treturn (offset < 0 ? '+' : '-') + hours + minutesOut;\n}\n","import timeZone from 'time-zone';\n\nexport default function dateTime(options = {}) {\n\tlet {\n\t\tdate = new Date(),\n\t\tlocal = true,\n\t\tshowTimeZone = false,\n\t\tshowMilliseconds = false\n\t} = options;\n\n\tif (local) {\n\t\t// Offset the date so it will return the correct value when getting the ISO string.\n\t\tdate = new Date(date.getTime() - (date.getTimezoneOffset() * 60000));\n\t}\n\n\tlet end = '';\n\n\tif (showTimeZone) {\n\t\tend = ' UTC' + (local ? timeZone(date) : '');\n\t}\n\n\tif (showMilliseconds && date.getUTCMilliseconds() > 0) {\n\t\tend = ` ${date.getUTCMilliseconds()}ms${end}`;\n\t}\n\n\treturn date\n\t\t.toISOString()\n\t\t.replace(/T/, ' ')\n\t\t.replace(/\\..+/, end);\n}\n","// This is not the set of all possible signals.\n//\n// It IS, however, the set of all signals that trigger\n// an exit on either Linux or BSD systems.  Linux is a\n// superset of the signal names supported on BSD, and\n// the unknown signals just fail to register, so we can\n// catch that easily enough.\n//\n// Don't bother with SIGKILL.  It's uncatchable, which\n// means that we can't fire any callbacks anyway.\n//\n// If a user does happen to register a handler on a non-\n// fatal signal like SIGWINCH or something, and then\n// exit, it'll end up firing `process.emit('exit')`, so\n// the handler will be fired anyway.\n//\n// SIGBUS, SIGFPE, SIGSEGV and SIGILL, when not raised\n// artificially, inherently leave the process in a\n// state from which it is not safe to try and enter JS\n// listeners.\nmodule.exports = [\n  'SIGABRT',\n  'SIGALRM',\n  'SIGHUP',\n  'SIGINT',\n  'SIGTERM'\n]\n\nif (process.platform !== 'win32') {\n  module.exports.push(\n    'SIGVTALRM',\n    'SIGXCPU',\n    'SIGXFSZ',\n    'SIGUSR2',\n    'SIGTRAP',\n    'SIGSYS',\n    'SIGQUIT',\n    'SIGIOT'\n    // should detect profiler and enable/disable accordingly.\n    // see #21\n    // 'SIGPROF'\n  )\n}\n\nif (process.platform === 'linux') {\n  module.exports.push(\n    'SIGIO',\n    'SIGPOLL',\n    'SIGPWR',\n    'SIGSTKFLT',\n    'SIGUNUSED'\n  )\n}\n","// Note: since nyc uses this module to output coverage, any lines\n// that are in the direct sync flow of nyc's outputCoverage are\n// ignored, since we can never get coverage for them.\n// grab a reference to node's real process object right away\nvar process = global.process\n// some kind of non-node environment, just no-op\nif (typeof process !== 'object' || !process) {\n  module.exports = () => {}\n} else {\n  var assert = require('assert')\n  var signals = require('./signals.js')\n  var isWin = /^win/i.test(process.platform)\n\n  var EE = require('events')\n  /* istanbul ignore if */\n  if (typeof EE !== 'function') {\n    EE = EE.EventEmitter\n  }\n\n  var emitter\n  if (process.__signal_exit_emitter__) {\n    emitter = process.__signal_exit_emitter__\n  } else {\n    emitter = process.__signal_exit_emitter__ = new EE()\n    emitter.count = 0\n    emitter.emitted = {}\n  }\n\n  // Because this emitter is a global, we have to check to see if a\n  // previous version of this library failed to enable infinite listeners.\n  // I know what you're about to say.  But literally everything about\n  // signal-exit is a compromise with evil.  Get used to it.\n  if (!emitter.infinite) {\n    emitter.setMaxListeners(Infinity)\n    emitter.infinite = true\n  }\n\n  module.exports = function (cb, opts) {\n    if (global.process !== process) {\n      return\n    }\n    assert.equal(typeof cb, 'function', 'a callback must be provided for exit handler')\n\n    if (loaded === false) {\n      load()\n    }\n\n    var ev = 'exit'\n    if (opts && opts.alwaysLast) {\n      ev = 'afterexit'\n    }\n\n    var remove = function () {\n      emitter.removeListener(ev, cb)\n      if (emitter.listeners('exit').length === 0 &&\n          emitter.listeners('afterexit').length === 0) {\n        unload()\n      }\n    }\n    emitter.on(ev, cb)\n\n    return remove\n  }\n\n  var unload = function unload () {\n    if (!loaded || global.process !== process) {\n      return\n    }\n    loaded = false\n\n    signals.forEach(function (sig) {\n      try {\n        process.removeListener(sig, sigListeners[sig])\n      } catch (er) {}\n    })\n    process.emit = originalProcessEmit\n    process.reallyExit = originalProcessReallyExit\n    emitter.count -= 1\n  }\n  module.exports.unload = unload\n\n  var emit = function emit (event, code, signal) {\n    if (emitter.emitted[event]) {\n      return\n    }\n    emitter.emitted[event] = true\n    emitter.emit(event, code, signal)\n  }\n\n  // { <signal>: <listener fn>, ... }\n  var sigListeners = {}\n  signals.forEach(function (sig) {\n    sigListeners[sig] = function listener () {\n      if (process !== global.process) {\n        return\n      }\n      // If there are no other listeners, an exit is coming!\n      // Simplest way: remove us and then re-send the signal.\n      // We know that this will kill the process, so we can\n      // safely emit now.\n      var listeners = process.listeners(sig)\n      if (listeners.length === emitter.count) {\n        unload()\n        emit('exit', null, sig)\n        /* istanbul ignore next */\n        emit('afterexit', null, sig)\n        /* istanbul ignore next */\n        if (isWin && sig === 'SIGHUP') {\n          // \"SIGHUP\" throws an `ENOSYS` error on Windows,\n          // so use a supported signal instead\n          sig = 'SIGINT'\n        }\n        process.kill(process.pid, sig)\n      }\n    }\n  })\n\n  module.exports.signals = function () {\n    return signals\n  }\n\n  var loaded = false\n\n  var load = function load () {\n    if (loaded || process !== global.process) {\n      return\n    }\n    loaded = true\n\n    // This is the number of onSignalExit's that are in play.\n    // It's important so that we can count the correct number of\n    // listeners on signals, and don't wait for the other one to\n    // handle it instead of us.\n    emitter.count += 1\n\n    signals = signals.filter(function (sig) {\n      try {\n        process.on(sig, sigListeners[sig])\n        return true\n      } catch (er) {\n        return false\n      }\n    })\n\n    process.emit = processEmit\n    process.reallyExit = processReallyExit\n  }\n  module.exports.load = load\n\n  var originalProcessReallyExit = process.reallyExit\n  var processReallyExit = function processReallyExit (code) {\n    if (process !== global.process) {\n      return\n    }\n    process.exitCode = code || 0\n    emit('exit', process.exitCode, null)\n    /* istanbul ignore next */\n    emit('afterexit', process.exitCode, null)\n    /* istanbul ignore next */\n    originalProcessReallyExit.call(process, process.exitCode)\n  }\n\n  var originalProcessEmit = process.emit\n  var processEmit = function processEmit (ev, arg) {\n    if (ev === 'exit' && process === global.process) {\n      if (arg !== undefined) {\n        process.exitCode = arg\n      }\n      var ret = originalProcessEmit.apply(this, arguments)\n      emit('exit', process.exitCode, null)\n      /* istanbul ignore next */\n      emit('afterexit', process.exitCode, null)\n      return ret\n    } else {\n      return originalProcessEmit.apply(this, arguments)\n    }\n  }\n}\n","import { MergedRollupOptions } from '../../src/rollup/types';\nimport { stderr } from '../logging';\n\nconst CLEAR_SCREEN = '\\u001Bc';\n\nexport function getResetScreen(\n\tconfigs: MergedRollupOptions[],\n\tallowClearScreen: boolean | undefined\n): (heading: string) => void {\n\tlet clearScreen = allowClearScreen;\n\tfor (const config of configs) {\n\t\tif (config.watch && config.watch.clearScreen === false) {\n\t\t\tclearScreen = false;\n\t\t}\n\t}\n\tif (clearScreen) {\n\t\treturn (heading: string) => stderr(CLEAR_SCREEN + heading);\n\t}\n\n\tlet firstRun = true;\n\treturn (heading: string) => {\n\t\tif (firstRun) {\n\t\t\tstderr(heading);\n\t\t\tfirstRun = false;\n\t\t}\n\t};\n}\n","import fs from 'fs';\nimport chokidar from 'chokidar';\nimport { bold, cyan, green, underline } from 'colorette';\nimport dateTime from 'date-time';\nimport ms from 'pretty-ms';\nimport onExit from 'signal-exit';\nimport * as rollup from '../../src/node-entry';\nimport { MergedRollupOptions, RollupWatcher } from '../../src/rollup/types';\nimport relativeId from '../../src/utils/relativeId';\nimport { handleError, stderr } from '../logging';\nimport { BatchWarnings } from './batchWarnings';\nimport { getConfigPath } from './getConfigPath';\nimport loadAndParseConfigFile from './loadConfigFile';\nimport loadConfigFromCommand from './loadConfigFromCommand';\nimport { getResetScreen } from './resetScreen';\nimport { printTimings } from './timings';\n\nexport async function watch(command: Record<string, any>): Promise<void> {\n\tprocess.env.ROLLUP_WATCH = 'true';\n\tconst isTTY = process.stderr.isTTY;\n\tconst silent = command.silent;\n\tlet configs: MergedRollupOptions[];\n\tlet warnings: BatchWarnings;\n\tlet watcher: RollupWatcher;\n\tlet configWatcher: fs.FSWatcher;\n\tconst configFile = command.config ? getConfigPath(command.config) : null;\n\n\tonExit(close);\n\tprocess.on('uncaughtException' as any, close);\n\tif (!process.stdin.isTTY) {\n\t\tprocess.stdin.on('end', close);\n\t\tprocess.stdin.resume();\n\t}\n\n\tasync function loadConfigFromFileAndTrack(configFile: string) {\n\t\tlet reloadingConfig = false;\n\t\tlet aborted = false;\n\t\tlet configFileData: string | null = null;\n\n\t\tconfigWatcher = chokidar.watch(configFile).on('change', () => reloadConfigFile());\n\t\tawait reloadConfigFile();\n\n\t\tasync function reloadConfigFile() {\n\t\t\ttry {\n\t\t\t\tconst newConfigFileData = fs.readFileSync(configFile, 'utf-8');\n\t\t\t\tif (newConfigFileData === configFileData) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (reloadingConfig) {\n\t\t\t\t\taborted = true;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (configFileData) {\n\t\t\t\t\tstderr(`\\nReloading updated config...`);\n\t\t\t\t}\n\t\t\t\tconfigFileData = newConfigFileData;\n\t\t\t\treloadingConfig = true;\n\t\t\t\t({ options: configs, warnings } = await loadAndParseConfigFile(configFile, command));\n\t\t\t\treloadingConfig = false;\n\t\t\t\tif (aborted) {\n\t\t\t\t\taborted = false;\n\t\t\t\t\treloadConfigFile();\n\t\t\t\t} else {\n\t\t\t\t\tif (watcher) {\n\t\t\t\t\t\twatcher.close();\n\t\t\t\t\t}\n\t\t\t\t\tstart(configs);\n\t\t\t\t}\n\t\t\t} catch (err: any) {\n\t\t\t\tconfigs = [];\n\t\t\t\treloadingConfig = false;\n\t\t\t\thandleError(err, true);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (configFile) {\n\t\tawait loadConfigFromFileAndTrack(configFile);\n\t} else {\n\t\t({ options: configs, warnings } = await loadConfigFromCommand(command));\n\t\tstart(configs);\n\t}\n\n\tconst resetScreen = getResetScreen(configs!, isTTY);\n\n\tfunction start(configs: MergedRollupOptions[]) {\n\t\ttry {\n\t\t\twatcher = rollup.watch(configs as any);\n\t\t} catch (err: any) {\n\t\t\treturn handleError(err);\n\t\t}\n\n\t\twatcher.on('event', event => {\n\t\t\tswitch (event.code) {\n\t\t\t\tcase 'ERROR':\n\t\t\t\t\twarnings.flush();\n\t\t\t\t\thandleError(event.error, true);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'START':\n\t\t\t\t\tif (!silent) {\n\t\t\t\t\t\tresetScreen(underline(`rollup v${rollup.VERSION}`));\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'BUNDLE_START':\n\t\t\t\t\tif (!silent) {\n\t\t\t\t\t\tlet input = event.input;\n\t\t\t\t\t\tif (typeof input !== 'string') {\n\t\t\t\t\t\t\tinput = Array.isArray(input)\n\t\t\t\t\t\t\t\t? input.join(', ')\n\t\t\t\t\t\t\t\t: Object.values(input as Record<string, string>).join(', ');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tstderr(\n\t\t\t\t\t\t\tcyan(`bundles ${bold(input)} â†’ ${bold(event.output.map(relativeId).join(', '))}...`)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'BUNDLE_END':\n\t\t\t\t\twarnings.flush();\n\t\t\t\t\tif (!silent)\n\t\t\t\t\t\tstderr(\n\t\t\t\t\t\t\tgreen(\n\t\t\t\t\t\t\t\t`created ${bold(event.output.map(relativeId).join(', '))} in ${bold(\n\t\t\t\t\t\t\t\t\tms(event.duration)\n\t\t\t\t\t\t\t\t)}`\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t\tif (event.result && event.result.getTimings) {\n\t\t\t\t\t\tprintTimings(event.result.getTimings());\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'END':\n\t\t\t\t\tif (!silent && isTTY) {\n\t\t\t\t\t\tstderr(`\\n[${dateTime()}] waiting for changes...`);\n\t\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ('result' in event && event.result) {\n\t\t\t\tevent.result.close().catch(error => handleError(error, true));\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction close(code: number | null) {\n\t\tprocess.removeListener('uncaughtException', close);\n\t\t// removing a non-existent listener is a no-op\n\t\tprocess.stdin.removeListener('end', close);\n\n\t\tif (watcher) watcher.close();\n\t\tif (configWatcher) configWatcher.close();\n\n\t\tif (code) {\n\t\t\tprocess.exit(code);\n\t\t}\n\t}\n}\n"],"names":["process","global","signalExitModule","require$$1","require$$2","stderr","getConfigPath","chokidar","loadAndParseConfigFile","handleError","loadConfigFromCommand","rollup.watch","underline","rollup.VERSION","cyan","bold","relativeId","green","ms","printTimings"],"mappings":"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"}